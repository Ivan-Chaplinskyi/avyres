class e extends HTMLElement{constructor(){super(),this.selectors={product:"[data-main-product]",sellingPlanGroups:"[data-selling-plan-group-selector]",sellingPlans:"[data-selling-plan-selector]",sellingPlansWrapper:"[data-selling-plans-wrapper]"},this.productBase=!1,this.productSelector=this.closest(this.selectors.product).querySelector("product-selector"),this.productSelector||(this.productSelector=this.closest(this.selectors.product),this.productBase=!0),this.productForm=this.closest(this.selectors.product).querySelector("product-form")}connectedCallback(){this.setHandlers()}setHandlers(){this.querySelector(this.selectors.sellingPlanGroups).addEventListener("change",this.onSellingGroupChange.bind(this)),this.querySelectorAll(this.selectors.sellingPlans).forEach(e=>e.addEventListener("change",e=>{e.target.closest("dropdown-input")?.classList?.remove("has-error"),this.updateProductSelector(e.target.value)}))}onSellingGroupChange(e){if("one-time"==e.target.value){Array.from(this.querySelectorAll(this.selectors.sellingPlans)).map(e=>{e.value=""});let e=this.querySelector(this.selectors.sellingPlansWrapper);e.style.maxHeight="0",e.classList.add("is-hidden"),this.closest(".product__purchase-options").querySelector(".product__purchase--info").classList.add("hidden"),this.updateProductSelector()}else{let t=e.target.querySelector(`option[value="${e.target.value}"]`).dataset.id,r=this.querySelector(this.selectors.sellingPlansWrapper);r.querySelectorAll("[data-id]").forEach(e=>{e.classList.toggle("is-hidden",e.dataset.id!==t)}),r.style.maxHeight=r.scrollHeight+"px",r.classList.remove("is-hidden")}}isOneTimePurchase(){return"one-time"===this.querySelector('[name="selling_plan_group"]').value}showError(){[...this.querySelectorAll(this.selectors.sellingPlansWrapper)].filter(e=>!e.classList.contains("is-hidden"))[0].querySelectorAll("dropdown-input").forEach(e=>e.classList.add("has-error"))}updateProductSelector(e){this.productBase?this.updateProductBase(e):(this.productSelector.currentVariant||this.productSelector.updateVariant(),this.productSelector.updateURL(e),this.productSelector.renderProductInfo(),this.productSelector.currentVariant.available&&e?this.productForm.setAttribute("data-has-selling-plan","true"):this.productForm.removeAttribute("data-has-selling-plan",!0),this.productForm.toggleAddButton(!1,""))}updateProductBase(e){var t=this.productSelector.getSelectedVariant(this.productSelector);this.productSelector.updateSellingPlanURL(e,t.id),this.renderPurchaseInfo(t.id),t.available&&e?this.productForm.setAttribute("data-has-selling-plan","true"):this.productForm.removeAttribute("data-has-selling-plan"),this.productForm.toggleSubmitButton(!1,"")}renderPurchaseInfo(e){var t=new URLSearchParams(window.location.search);t[t.has("variant")?"set":"append"]("variant",e),fetch(this.productSelector.dataset.url+"?"+t.toString()).then(e=>e.text()).then(e=>{let t=(new DOMParser).parseFromString(e,"text/html");["#Product-Purchase-Options-"+this.productSelector.dataset.section,"#ProductPurchaseInfo-"+this.productSelector.dataset.section].map(e=>{var r=document.querySelector(e);e=t.querySelector(e);r&&e&&(r.classList.remove("hidden"),r.innerHTML=e.innerHTML)})}).catch(e=>{console.error(e)})}}customElements.define("purchase-options",e);